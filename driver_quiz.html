<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alberta Basic Licence Driver's Assessment</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --light: #ecf0f1;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 800px;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 20px;
        }

        /* Start Screen Styles */
        #start-screen {
            text-align: center;
            padding: 40px 20px;
        }
        
        .input-group {
            margin: 25px 0;
        }

        input[type="text"] {
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 70%;
            max-width: 300px;
            text-align: center;
        }

        /* Quiz Header */
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .player-name {
            font-weight: bold;
            color: var(--accent);
        }

        .progress-bar {
            width: 100%;
            background-color: #ddd;
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-box {
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .question-image {
            max-width: 100%;
            max-height: 250px;
            display: block;
            margin: 10px auto;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }

        button.option-btn {
            padding: 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
            position: relative;
        }

        button.option-btn:hover {
            border-color: var(--accent);
            background-color: #f0f8ff;
        }

        button.option-btn.selected {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Feedback Styles */
        button.option-btn.correct {
            background-color: var(--success) !important;
            color: white !important;
            border-color: var(--success) !important;
        }

        button.option-btn.wrong {
            background-color: var(--danger) !important;
            color: white !important;
            border-color: var(--danger) !important;
        }

        .feedback-msg {
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            height: 30px; /* reserve space */
            margin-top: 10px;
        }

        .feedback-correct { color: var(--success); }
        .feedback-wrong { color: var(--danger); }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            color: white;
        }

        .btn-start { background-color: var(--success); font-size: 1.2rem; padding: 15px 40px; }
        .btn-next { background-color: var(--accent); }
        .btn-next:hover { background-color: #2980b9; }

        .btn-finish { 
            background-color: #7f8c8d; 
            font-size: 0.9rem;
            padding: 10px 15px;
        }
        .btn-finish:hover { background-color: #95a5a6; }

        /* Results Section */
        #results-container {
            display: none;
        }

        .score-card {
            text-align: center;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        .review-item {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }

        .review-q {
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Style for review images */
        .review-img {
            max-width: 100%;
            max-height: 150px;
            display: block;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .user-ans { color: var(--danger); }
        .correct-ans { color: var(--success); font-weight: bold; }
        
        .img-placeholder {
            background: #eee;
            padding: 10px;
            text-align: center;
            font-style: italic;
            color: #666;
            margin-bottom: 10px;
            border: 1px dashed #999;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="start-screen">
        <h1>Driver's Knowledge Assessment</h1>
        <p>120 Questions from the Alberta Basic Licence Driver's Handbook</p>
        <div class="input-group">
            <input type="text" id="username-input" placeholder="Enter Your Name">
        </div>
        <button class="btn btn-start" onclick="startGame()">Start Quiz</button>
    </div>

    <div id="quiz-container" style="display:none;">
        <div class="quiz-header">
            <h2 style="margin:0; font-size:1.2rem;">Alberta Driver Exam</h2>
            <div class="player-name" id="display-name">Player: </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <div id="question-area" class="question-box">
            </div>

        <div id="feedback-area" class="feedback-msg"></div>

        <div class="controls">
            <span id="counter">Question 1 of 120</span>
            
            <div style="display:flex; gap:10px;">
                <button class="btn btn-finish" onclick="finishQuiz()">Finish Exam Now</button>
                <button class="btn btn-next" id="next-btn" onclick="checkAnswer()">Next</button>
            </div>
        </div>
    </div>

    <div id="results-container">
        <h1 id="result-header">Exam Results</h1>
        <div class="score-card">
            <div>You scored</div>
            <div class="score-number" id="final-score">0 / 0</div>
            <div id="percentage">0%</div>
            <p id="pass-fail-msg"></p>
        </div>
        <h3>Review Incorrect Answers:</h3>
        <div id="review-list">
            </div>
        <br>
        <button class="btn btn-next" onclick="location.reload()">Retake Exam</button>
    </div>
</div>

<script>
    const originalQuestions = [
        { id: 1, text: "Unless otherwise posted, what is the basic speed limit outside a city, town or village on a primary highway?", options: ["100 km/h", "90 km/h", "110 km/h", "80 km/h"], correct: 0 },
        { id: 2, text: "When backing a passenger vehicle to the left, a driver should:", options: ["Look in the inside rear-view mirror and make steering adjustments as necessary", "Look over the right shoulder with occasional glances to the front", "Look over the left shoulder with occasional glances to the front", "Without shoulder checking, use the inside and outside rear-view mirrors"], correct: 2 },
        { id: 3, text: "When approaching an intersection and facing a traffic control light that is showing a green right-turn arrow and a red light, a driver:", options: ["Must stop and wait for a green light before turning in the direction of the arrow", "May go straight through the intersection without stopping", "May proceed when safe, without stopping, in the direction of the arrow", "May turn left without stopping"], correct: 2 },
        { id: 4, text: "Alberta has a demerit point system where a fully licenced (non-learner, non-probationary) driver is suspended when they accumulate:", options: ["15 points", "8 points", "5 points", "12 points"], correct: 0 },
        { id: 5, text: "When passing a large truck on a two-way highway, a driver should:", options: ["Leave extra room before returning to their lane", "Return to their lane when signalled by the truck's headlights", "Return to their lane when the truck is no longer visible in any mirrors", "Return to their lane once they have cleared the truck's front bumper"], correct: 0 },
        { id: 6, text: "Which statement best describes the steps for turning right at a red traffic light?", options: ["Right turns on a red traffic light are never permitted", "Signal and make sure there is no sign prohibiting the turn, stop, look left and right, yield the right-of-way, then proceed", "Reduce speed before the turn, look right for cyclists, signal and proceed", "Signal and reduce speed before the turn, look left, yield to vehicles and proceed"], correct: 1 },
        { id: 7, text: "This sign indicates:", imgDesc: "Image: A green circle with a black diamond inside", options: ["Route for vehicles over 4500 kg", "Route for slow moving vehicles", "Reserved lane for buses", "Dangerous goods route"], correct: 3 },
        { id: 8, text: "A single solid white line between driving lanes in an urban area means:", options: ["It is a line separating traffic travelling in opposite directions", "Traffic on the right is moving faster than traffic on the left", "Lane changing is not permitted", "Lane change is permitted"], correct: 2 },
        { id: 9, text: "A 'parking lane' as defined in the Basic Licence Driver's Handbook is:", options: ["A lane closest to the curb, where parking is permitted but there are no meters", "All of these responses are correct", "That portion of a primary highway between the edge of the roadway to the right of the direction of traffic and the nearest solid white line, not being the centre line", "A lane immediately beside a row of parking meters in an urban area"], correct: 2 },
        { id: 10, text: "Shoulder checking means:", options: ["Glancing towards the blind spot in the direction the driver intends to move", "Glancing into the left outside mirror", "Glancing into both the inside and outside mirrors", "Glancing into the right outside mirror"], correct: 0 },
        { id: 11, text: "This sign indicates:", imgDesc: "Image: Orange diamond with a car silhouette tilted", options: ["Off-road facilities ahead", "Slippery when wet", "Uneven pavement", "Detour ahead"], correct: 2 },
        { id: 12, text: "A traffic-lane control light with an illuminated red 'X' means:", imgDesc: "Image: Overhead lights with Red X over a lane", options: ["Prepare for an emergency vehicle travelling in that lane", "Reduce speed to below 30 km/h", "Use that lane only for the purpose of making left turns", "Travel is not permitted in that lane"], correct: 3 },
        { id: 13, text: "Does a parent have the right to withdraw a previously given 'parental consent' for someone under 18 years of age with respect to an operator's licence?", options: ["Yes, provided the person is still under the age of 18 and is not self-supporting or married", "Yes, provided that both parents verbally agree to withdraw the consent at a registry office", "No, once it is given it remains in effect until the person reaches 18 years of age", "No, but another consent form must be signed by both parents after a licence suspension"], correct: 0 },
        { id: 14, text: "When approaching a Yield sign, you must:", options: ["Yield the right-of-way to traffic not facing the sign and all pedestrians in the intersection", "Always sound the horn to warn other traffic within the intersection", "Expect all other vehicles to yield the right-of-way to you", "Come to a stop and proceed after looking to the right and left"], correct: 0 },
        { id: 15, text: "The term 'over-driving' your headlights at night means:", options: ["The driver cannot see clearly for 1000 metres", "The low beam headlights are not set properly", "The driver is travelling at a speed which would not permit them to see an object in time to stop", "The driver has had the headlights on for too long a time"], correct: 2 },
        { id: 16, text: "Under the Graduated Driver Licensing program, a driver will receive 2 demerits:", options: ["For having more passengers than there are seat belts", "For not wearing a seat belt securely fastened", "For not wearing a seat belt", "For not wearing a seat belt properly adjusted"], correct: 0 },
        { id: 17, text: "Using the 2-second rule to judge a safe following distance when driving:", options: ["Is more accurate on rural highways than in urban centres", "Is not accurate at speeds greater than 100 km/h", "Is accurate at any speed", "Is not accurate at speeds lower than 30 km/h"], correct: 2 },
        { id: 18, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with a curved arrow pointing right", options: ["Traffic entering from the right", "Winding road ahead", "Curve right", "Concealed intersection on the right"], correct: 2 },
        { id: 19, text: "A driver approaching a flashing red traffic light must:", options: ["Stop and wait for the flashing green light", "Reduce speed and proceed with caution", "Stop and proceed only when safe to do so", "Stop until the signal light turns green"], correct: 2 },
        { id: 20, text: "This sign indicates:", imgDesc: "Image: Yellow diamond containing a Yield symbol and an arrow pointing up", options: ["Do not enter", "Slow moving vehicles ahead", "Warning, Yield sign ahead", "Warning, traffic is approaching"], correct: 2 },
        { id: 21, text: "According to the law in Alberta, it is the driver's responsibility to ensure that all passengers under what age are properly restrained in the vehicle?", options: ["18 years", "24 years", "21 years", "16 years"], correct: 3 },
        { id: 22, text: "When parallel parking, the vehicle's wheels closest to the curb must be within what maximum distance?", options: ["80 centimetres from the curb", "30 centimetres from the curb", "70 centimetres from the curb", "50 centimetres from the curb"], correct: 3 },
        { id: 23, text: "Who is responsible and legally obligated to report any medical condition, change in health, or physical disability that may affect a driver's ability to drive?", options: ["The driver's employer", "The driver", "The driver's doctor", "The driver's insurance company"], correct: 1 },
        { id: 24, text: "This sign indicates:", imgDesc: "Image: Yellow diamond, road narrows icon", options: ["Road narrows, left", "Two-way traffic", "Divided highway ends", "Obstruction - keep left"], correct: 0 },
        { id: 25, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with jagged/bumpy line", options: ["Rumble strips", "Construction zone", "Bump", "Pavement ends"], correct: 2 },
        { id: 26, text: "Under the Graduated Driver Licensing program, what is the minimum amount of time that a person must serve as a probationary Class 5 driver?", options: ["6 months", "18 months", "2 years", "1 year"], correct: 2 },
        { id: 27, text: "A large 'X' painted on the pavement indicates:", options: ["Construction ahead", "The traffic lane is ending", "Railway crossing ahead", "Wild animal crossing ahead"], correct: 2 },
        { id: 28, text: "A driver is required to report all collisions to the police when persons have been injured or killed, or when combined damage to all vehicles or property is more than:", options: ["$750", "$1000", "$250", "$500"], correct: 1 },
        { id: 29, text: "When a driver is stopping behind another vehicle in traffic:", options: ["Remain a minimum of 10 metres from the vehicle ahead", "Allow sufficient space to move into another lane without reversing", "Maintain sufficient space as determined by the 2-second rule", "Keep back approximately 1 metre from the rear bumper of the vehicle ahead"], correct: 1 },
        { id: 30, text: "If another vehicle is following too close, what should a driver do?", options: ["Slow down gradually and encourage the other vehicle to pass", "Press hard on the brake pedal", "Increase speed to 10 km/h above the posted speed limit", "Activate the four-way flashers"], correct: 0 },
        { id: 31, text: "When recovering from a skid, a driver should:", options: ["Accelerate and steer in the opposite direction of the skid", "Brake and counter-steer", "Steer in the direction the driver wants the front of the vehicle to go", "Brake and hold firmly on the steering wheel"], correct: 2 },
        { id: 32, text: "A 'slow-moving vehicle' sign must be displayed on the rear of any vehicle that normally travels at speeds less than:", options: ["50 km/h", "40 km/h", "70 km/h", "60 km/h"], correct: 1 },
        { id: 33, text: "A driver attempting to turn left at a steady green traffic light:", options: ["Has the right-of-way over oncoming traffic", "Must stop before the pedestrian crosswalk line, then proceed", "Has the right-of-way over pedestrians", "Must not cross the path of an approaching vehicle unless it is safe"], correct: 3 },
        { id: 34, text: "A 'Weave Zone' is best described as:", options: ["A place on a highway where the entrance and exit lanes are close together, and vehicles must drive between them", "An area on the highway that is used for emergency parking", "A place where the highway has a series of curves", "A limited access area where a driver can back their vehicle"], correct: 0 },
        { id: 35, text: "A road test will be refused by a driver examiner if:", options: ["The vehicle has a seating capacity greater than 7", "The vehicle is registered as a farm vehicle", "The vehicle is a rental vehicle", "The vehicle is not mechanically safe"], correct: 3 },
        { id: 36, text: "Is a driver allowed to exceed the speed limit when passing another vehicle?", options: ["Only when passing more than one vehicle at a time", "Yes, but not more than 10 km/h over the speed limit", "Yes, on primary highways only", "No, it is never permitted"], correct: 3 },
        { id: 37, text: "This sign indicates:", imgDesc: "Image: Green/Yellow Pentagon with figures walking", options: ["Children playing in residential area", "Pedestrian crosswalk ahead", "School area", "Playground zone"], correct: 2 },
        { id: 38, text: "The speed limit in a construction zone must be obeyed:", options: ["Only during daylight hours", "Only when a flag person is posted nearby", "At all times", "Only when construction workers are present"], correct: 2 },
        { id: 39, text: "In a vehicle that does not have anti-lock brakes, threshold braking refers to:", options: ["Applying an even braking force to the point just before the wheels lock, and easing off slightly if the wheels lock", "Pumping the brake pedal repeatedly until the vehicle comes to a stop", "Releasing pressure on the brake pedal, then reapplying pressure until the wheels lock", "Applying enough force to the brake pedal to lock the wheels and keep them locked"], correct: 0 },
        { id: 40, text: "When a driver's vehicle is approached by an emergency vehicle sounding a siren, from any direction on a two-way road, the driver must:", options: ["Continue at a reduced speed", "Turn on their four-way hazard lights", "Stop only when the emergency vehicle has difficulty passing", "Drive as close as possible to the right curb or edge of the road and stop"], correct: 3 },
        { id: 41, text: "The recommended braking procedure to bring a vehicle to a normal, smooth stop is:", options: ["Continually increase brake pressure until the wheels lock", "Shift the vehicle into neutral and apply steady pressure", "Pump the brake pedal smoothly", "Apply brake pressure, ease off slightly just before the vehicle stops, then re-apply sufficient pressure to stop"], correct: 3 },
        { id: 42, text: "In Alberta, the law requires that seat belts must be worn:", options: ["Only while carrying passengers", "Properly at all times", "Only when driving at highway speeds", "Only when driving in the city"], correct: 1 },
        { id: 43, text: "This sign indicates:", imgDesc: "Image: Red Circle with Slash over two cars side by side", options: ["Heavy trucks only", "Do not pass", "No vehicles allowed", "Do not enter"], correct: 1 },
        { id: 44, text: "A driver entering a traffic circle:", options: ["Must yield to traffic on the right", "Must yield to vehicles in the traffic circle", "Has the right-of-way", "Must use the courtesy rule and yield to the vehicle that arrived first"], correct: 1 },
        { id: 45, text: "A deceleration lane is:", options: ["A lane where vehicles reduce speed when exiting a highway", "The right lane of a four-lane highway for use by slower moving vehicles", "The lane immediately to the right of a solid yellow line on a highway", "A lane on hills for use by slower moving vehicles"], correct: 0 },
        { id: 46, text: "When turning left from a two-way road onto a one-way road, what lane should the vehicle enter?", imgDesc: "Image: Intersection diagram, red car turning left", options: ["The lane immediately to the right of centre", "The lane nearest the curb on the left side of the one-way road", "The centre lane of the one-way road", "The right lane of the one-way road"], correct: 1 },
        { id: 47, text: "When two vehicles approach an uncontrolled 'T' intersection at right angles to each other at approximately the same time:", imgDesc: "Image: T-Intersection diagram", options: ["The vehicle on the left must yield the right-of-way", "The vehicle on the left has the right-of-way", "The vehicle going straight through always has the right-of-way", "Both vehicles must stop"], correct: 0 },
        { id: 48, text: "Unless otherwise permitted, what lane must a driver be in to turn left from a one-way road?", options: ["The lane to the right of centre", "The left lane nearest the left curb", "The lane closest to the right curb", "The centre lane"], correct: 1 },
        { id: 49, text: "Which statement describes the steps required to reverse in a straight line?", options: ["Keep both hands on the steering wheel and constantly use the inside rear-view mirror", "Place the right hand at the top of the steering wheel, look over left shoulder", "Place the left hand at the top of the steering wheel and look over the right shoulder through the rear window", "Place the left hand at the bottom of the steering wheel and use both outside mirrors"], correct: 2 },
        { id: 50, text: "An acceleration lane is:", options: ["A lane with broken line markings", "A lane on hills, designated for faster moving vehicles", "The left lane of a four-lane highway", "A lane in a merge area for use by vehicles entering the highway"], correct: 3 },
        { id: 51, text: "This sign indicates:", imgDesc: "Image: Yellow diamond, right lane ending graphic", options: ["Lane ends, loss of right lane", "Added lane (free flow)", "Curve right", "Dual turn lane ahead"], correct: 0 },
        { id: 52, text: "Under the Graduated Driver Licensing program, a learner with a Class 7 licence is not permitted to drive a vehicle between the hours of:", options: ["9:00 A.M. and 5:00 P.M.", "Midnight and 5:00 A.M.", "10:00 P.M. and 6:00 A.M.", "Midnight and 7:00 A.M."], correct: 1 },
        { id: 53, text: "What does a flashing yellow traffic light mean?", options: ["The traffic light will turn green", "Stop until the light stops flashing", "The traffic light will turn red", "Proceed with caution"], correct: 3 },
        { id: 54, text: "Unless otherwise posted, the school zone speed limits are in effect on school days during the following hours:", options: ["8:30 A.M. to 1 hour after sunset", "8:00 A.M. to 9:30 A.M., 11:30 A.M. to 1:30 P.M. and 3:00 P.M. to 4:30 P.M.", "8:30 A.M. to 9:30 A.M., 12:00 P.M. to 1:00 P.M. and 3:30 P.M. to 4:00 P.M.", "8:00 A.M. to 4:30 P.M."], correct: 1 },
        { id: 55, text: "This sign indicates:", imgDesc: "Image: White rectangle, figure walking", options: ["Playground zone", "Pedestrian crosswalk", "Designated school bus stop", "School zone"], correct: 1 },
        { id: 56, text: "When driving in the right lane on a highway, what should a driver do if another vehicle attempts to merge from an acceleration lane on the right?", options: ["Stop to allow the other vehicle in", "Accelerate to close any gap in the traffic flow", "Move into the left lane if it is safe to do so, or be prepared to adjust speed", "Insist that the other vehicle yield the right-of-way"], correct: 2 },
        { id: 57, text: "Which direction should a vehicle’s front wheels be turned when parked uphill on a two-way road with a curb?", options: ["Parallel to the curb", "To the left", "To the right", "Straight ahead"], correct: 1 },
        { id: 58, text: "When approaching the rear of a stopped school bus that has its alternately flashing red lights activated, a driver must:", options: ["Sound the horn to alert any pedestrians and pass at a slow rate of speed", "Stop behind the bus and wait until the alternating red lights stop flashing", "Move to the left lane, reduce speed to 30 km/h and pass cautiously", "Stop behind the bus, look carefully for pedestrians and, if clear, drive past the bus slowly"], correct: 1 },
        { id: 59, text: "When travelling in urban areas, drivers should scan the road approximately:", options: ["25 to 30 seconds ahead", "12 to 15 seconds ahead", "20 to 30 seconds ahead", "1 to 6 seconds ahead"], correct: 1 },
        { id: 60, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with T shape", options: ["T intersection", "Traffic lane ends", "Concealed intersection", "Trucks entering highway ahead"], correct: 0 },
        { id: 61, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with winding arrow", options: ["Winding road ahead", "Weave zone ahead", "Slippery when wet", "Lane changing permitted"], correct: 0 },
        { id: 62, text: "Before leaving a parallel parking space on the right side of a road:", options: ["Turn on the right signal", "Shoulder check to the left", "Shoulder check to the right", "Use an arm signal straight out and up"], correct: 1 },
        { id: 63, text: "When approaching the top of a hill on a two-lane highway:", options: ["Exceeding the speed limit is permitted", "Flash the headlights to warn oncoming vehicles", "Stay to the right portion of the lane", "Keep close to the centre line to prevent others from passing"], correct: 2 },
        { id: 64, text: "Playground zones are in effect:", options: ["From 8:30 A.M. to 1 hour after sunset", "From 8:00 A.M. to 8:00 P.M.", "During daylight hours and until 11:00 P.M.", "Only when school lets out at noon and after 4:30 P.M."], correct: 0 },
        { id: 65, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with arrow merging into straight line", options: ["“T” intersection", "Winding road ahead", "Merging traffic", "Road narrows to the right"], correct: 2 },
        { id: 66, text: "According to the Basic Licence Driver’s Handbook, most skids are the result of:", options: ["Bad brakes", "Icy roads", "Bad tires", "Driver error"], correct: 3 },
        { id: 67, text: "How close can a driver legally park a vehicle to a Stop sign?", options: ["10 metres", "5 metres", "3 metres", "1.5 metres"], correct: 1 },
        { id: 68, text: "Parking in a space reserved for persons with disabilities is permitted:", options: ["When all other parking spaces are filled", "While the driver is waiting in the vehicle", "When a driver stops for less than 5 minutes", "When the vehicle has a proper identifying placard or licence plate"], correct: 3 },
        { id: 69, text: "At what minimum distance must headlights be dimmed at night when approaching another vehicle from behind?", options: ["60 metres", "300 metres", "150 metres", "100 metres"], correct: 2 },
        { id: 70, text: "When are dual turns permitted at an intersection?", imgDesc: "Image: Black sign showing two left turning arrows in separate lanes", options: ["Only when turning from a one-way road onto a one-way road", "Only when indicated by pavement markings or traffic control signs", "Any time there are at least 2 lanes on the road being entered", "Only when the road has 6 or more lanes"], correct: 1 },
        { id: 71, text: "This sign indicates:", imgDesc: "Image: White rectangle, two arrows pointing opposite directions with dotted line", options: ["Through lane only", "Passing permitted", "No turns permitted", "Two-way traffic"], correct: 3 },
        { id: 72, text: "Under the Graduated Driver Licensing program, a learner with a Class 7 operator’s license is suspended when they accumulate:", options: ["15 demerits", "12 demerits", "8 demerits", "7 demerits"], correct: 2 },
        { id: 73, text: "Speed limit signs indicate:", options: ["The speed you should travel under all driving conditions", "The minimum speed permitted on all highways", "The maximum speed permitted when conditions are favourable", "The maximum speed permitted except when passing"], correct: 2 },
        { id: 74, text: "An “uncontrolled intersection”:", options: ["Has a flashing yellow light for one direction of traffic and a flashing red light for the other direction of traffic", "Has traffic signs but no traffic control signal lights", "Has no traffic control signal lights or traffic signs", "Has Yield signs but no Stop signs"], correct: 2 },
        { id: 75, text: "This sign indicates:", imgDesc: "Image: Black sign, arrow curving left and another splitting straight/left", options: ["Sharp left curve in the road ahead", "Left turns are prohibited", "Vehicles may turn left or go straight", "Double lane left turn"], correct: 3 },
        { id: 76, text: "When facing a Merge sign a driver should:", options: ["Stop at the entrance to the other highway and wait until a gap in traffic occurs before proceeding", "Watch for a gap in traffic on the highway they are entering, adjust to highway speed in the acceleration lane and blend in smoothly", "Stop and yield the right-of-way to traffic already on the highway", "Reduce speed and proceed with caution"], correct: 1 },
        { id: 77, text: "In reduced visibility due to fog, smoke or snow, use the:", options: ["Park lights", "Headlights on high beam", "Headlights on low beam", "Daytime running lights"], correct: 2 },
        { id: 78, text: "This sign indicates:", imgDesc: "Image: Red 'X' shape (Crossbuck)", options: ["Emergency vehicles entering roadway", "The designated lane is closed", "Railway crossing", "Do not enter"], correct: 2 },
        { id: 79, text: "Is a driver allowed to turn right at a red traffic control light?", options: ["Yes, but only when a sign permits such a turn", "Yes, if the driver reduces speed and there is no traffic or pedestrian in the intersection, and no sign that prohibits such a turn", "Yes, if the driver stops and there is no traffic, pedestrian or sign that prohibits such a turn", "No, right turns on a red traffic light are never permitted"], correct: 1 },
        { id: 80, text: "This sign indicates:", imgDesc: "Image: Diamond symbol with Bus/Taxi icons and times", options: ["Lane is reserved for use by the specified vehicles", "One-way traffic only", "Car pool vehicles only", "Lane can be used for dangerous goods vehicles"], correct: 0 },
        { id: 81, text: "When a vehicle is stopped to allow a pedestrian to cross the road, other vehicles that are approaching from the rear:", options: ["May pass the stopped vehicle if there is no oncoming traffic that may impede passing safely", "Must not pass the stopped vehicle. It is illegal", "May pass the stopped vehicle when eye contact is made with the pedestrian and the pedestrian stops", "May pass the stopped vehicle when the pedestrian crossing signal has changed to “Don’t Walk”"], correct: 1 },
        { id: 82, text: "When a head restraint is raised to the proper position, the centre of the head restraint is:", options: ["Level with the top of the ears", "Level with the top of the shoulders", "Level with the neck", "Level with the top of the head"], correct: 0 },
        { id: 83, text: "This sign indicates:", imgDesc: "Image: Yellow rectangle with traffic light graphic", options: ["School zone ahead", "Caution log trucks turning", "Traffic control signal advance warning", "Pedestrian crosswalk ahead"], correct: 2 },
        { id: 84, text: "When a “PASSING LANE AHEAD” sign is posted, the driver of a slower moving vehicle should:", options: ["Use the right lane and reduce their speed to half the posted speed limit", "Use the left lane only", "Increase speed", "Move into the right lane when safe"], correct: 3 },
        { id: 85, text: "When approaching the rear of a school bus that is displaying alternating flashing amber lights, a driver should:", options: ["Be prepared to stop as this is a warning that the alternating flashing red lights will come on once the bus has stopped", "Be prepared to stop as this could be a warning that there is a collision ahead and the traffic flow has stopped", "Stop immediately because the school bus is loading or unloading students", "Use caution as the school bus is approaching a railroad crossing and is about to stop"], correct: 0 },
        { id: 86, text: "In the Basic Licence Driver’s Handbook, “nighttime” is defined as the period of time:", options: ["Beginning 1 hour before sunset and ending 1 hour after the following sunrise", "Beginning at sunset and ending at the following sunrise", "Between 7:00 P.M. and 7:00 A.M.", "Beginning 1 hour after sunset and ending 1 hour before the following sunrise"], correct: 3 },
        { id: 87, text: "This sign indicates:", imgDesc: "Image: Black sign with white arrow splitting straight and right", options: ["No through traffic or right turns", "Turn left or go straight through", "Turn from a one-way road onto a one-way road", "Straight through or right turn"], correct: 3 },
        { id: 88, text: "A vehicle exiting a parking lot onto a roadway:", options: ["Must stop only if there is a Stop sign", "Must come to a complete stop", "Must stop before crossing the sidewalk only if there are predestrians present", "Is not required to stop"], correct: 1 },
        { id: 89, text: "When approaching a railway crossing that has the flashing red light and bell activated:", options: ["Cross the tracks if the train is a minimum of 250 metres away", "Reduce speed, check for trains, and then proceed across the tracks", "Do not stop and do not change gears while crossing the tracks", "Stop at least 5 metres from the nearest rail until the train has passed"], correct: 3 },
        { id: 90, text: "The recommended method for travelling through a curve on a highway is:", options: ["Reduce speed before the curve, stay in the lane and gently accelerate after entering the curve", "Maintain speed before the curve, brake in the curve, look ahead and accelerate out of the curve", "Cover the brake pedal before the curve, counter-steer toward the outside of the lane and accelerate when exiting", "Accelerate before the curve, cover the brake pedal in the curve and accelerate after leaving the curve"], correct: 0 },
        { id: 91, text: "This sign indicates:", imgDesc: "Image: Red/Orange triangle", options: ["Yield the right-of-way to pedestrians and traffic", "Dangerous goods vehicle placard: flammable gas", "Slow moving vehicle", "Warning, Yield sign ahead"], correct: 2 },
        { id: 92, text: "Why is it not safe to pass a loaded log-haul truck that is turning?", options: ["The driver of the truck needs to fully concentrate on the turn and does not need the added responsibility of a passing vehicle", "Loaded log-haul trucks obey the 6-second rule for turns", "A danger zone exists as the overhang of the logs from the tail end of the truck could block all the lanes on a highway during the turn", "It is illegal to do so"], correct: 2 },
        { id: 93, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with bus icon and person figure", options: ["Playground zone ahead", "Pedestrian crossing ahead", "School bus stop ahead", "School zone ahead"], correct: 2 },
        { id: 94, text: "When encountering a funeral processions that is crossing an intersection:", options: ["Sound the horn before proceeding", "Proceed through the funeral procession only when there is sufficient space between vehicles", "Yield the right-of-way and do not break through the procession", "Flash the high beam headlights before proceeding"], correct: 2 },
        { id: 95, text: "If the vehicle’s right tires travel off the paved portion of the roadway:", options: ["Apply the brakes and counter-steer to return to the paved portion of the roadway", "Keep a firm grip on the steering wheel, ease off the gas pedal, and then gradually return to the paved portion of the roadway", "Accelerate slightly, then turn the steering wheel sharply to return to the paved portion of the roadway", "Move the vehicle completely off the paved portion, then steer back onto the paved portion of the roadway"], correct: 1 },
        { id: 96, text: "This sign indicates:", imgDesc: "Image: Green pentagon (school sign)", options: ["A school zone", "School crosswalk ahead", "Playground zone", "Pedestrian activated lights ahead"], correct: 1 },
        { id: 97, text: "When completing an angle park, the vehicle’s front wheel must be within what maximum distance from the nearest curb?", options: ["100 cm", "50 cm", "25 cm", "75 cm"], correct: 1 },
        { id: 98, text: "In an urban area, when a pedestrian is standing at a crosswalk with their arm raised at approximately right angles to their body and pointing to the opposite curb, what does this mean?", options: ["Drivers must stop and yield to the pedestrian", "The pedestrian is visually impaired and needs assistance to cross the road", "Drivers do not have to yield to the pedestrian until they step off the curb", "Drivers should reduce speed to 20 km/h and be cautious when passing the pedestrian"], correct: 0 },
        { id: 99, text: "This sign indicates:", imgDesc: "Image: Diamond with black/yellow checkerboard", options: ["Pavement ends", "Construction zone ahead", "Dead end", "Hazard marker"], correct: 2 },
        { id: 100, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with arrows merging and a divider at the bottom", options: ["Divided highway ends", "Divided highway begins", "Obstruction – pass on the left", "Two-way traffic"], correct: 0 },
        { id: 101, text: "When approaching an intersection displaying a steady yellow traffic light:", options: ["Proceed since the light is about to turn green", "Yield to vehicles on the right", "Stop before the intersection unless the stop cannot be made in safety", "Increase speed to clear the intersection"], correct: 2 },
        { id: 102, text: "A solid yellow line together with a broken yellow line marked on the centre of a highway means:", options: ["The road narrows ahead", "If the solid line is on your side, passing is permitted", "If the broken line is on your side, passing is not permitted", "If the broken line is on your side, passing is permitted"], correct: 3 },
        { id: 103, text: "At 9:00 A.M. on a school day, what is the maximum speed permitted in a school zone in a rural area, unless otherwise posted?", options: ["50 km/h", "20 km/h", "40 km/h", "30 km/h"], correct: 3 },
        { id: 104, text: "On a two-lane highway, when passing other vehicles travelling in the same direction, a driver:", options: ["Should pass on the left when safe", "Should pass on the right when safe", "Should always travel 30 km/h faster than the vehicle being passed", "Should not pull out to pass until they are within 3 metres of the vehicle being passed"], correct: 0 },
        { id: 105, text: "This sign indicates:", imgDesc: "Image: Green square with white H", options: ["Off-road facilities", "Hospital services", "Hotel services", "Primary highway route marker"], correct: 1 },
        { id: 106, text: "What minimum distance from a fire hydrant must a vehicle be parked?", options: ["3 metres", "4 metres", "2 metres", "5 metres"], correct: 3 },
        { id: 107, text: "This sign indicates:", imgDesc: "Image: Orange diamond with construction worker", options: ["Construction sign, flag person ahead", "Construction sign, detour ahead", "Caution, falling rock ahead", "Construction sign, people working ahead"], correct: 3 },
        { id: 108, text: "If a driver is being followed by a vehicle that is attempting to pass on a two-way road, the driver should:", options: ["Stay in the lane and move to the left portion of the lane", "Stay in the lane and move to the right portion of the lane", "Turn on the left signal and stay in the lane", "Turn on the right signal and drive in the parking lane"], correct: 1 },
        { id: 109, text: "When passing an emergency vehicle that is stopped with its flashing lights operating, the maximum speed allowed is:", options: ["60 km/h or the posted speed limit, whichever is lower", "50 km/h", "70 km/h", "30 km/h"], correct: 0 },
        { id: 110, text: "Drivers under the GDL (Graduated Driver Licensing) program must maintain a blood alcohol level of:", options: ["0.00%", "0.05%", "0.08%", "0.02%"], correct: 0 },
        { id: 111, text: "You are not allowed to make a U-turn at:", options: ["An intersection controlled by a traffic control signal (traffic lights)", "A roadway between intersections", "An alley intersection", "An uncontrolled intersection"], correct: 0 },
        { id: 112, text: "When parking near a marked crosswalk, what is the minimum distance you must maintain from the crosswalk?", options: ["5 metres", "3 metres", "10 metres", "2 metres"], correct: 0 },
        { id: 113, text: "Use your low-beam headlights when following another vehicle within:", options: ["150 metres", "300 metres", "60 metres", "100 metres"], correct: 0 },
        { id: 114, text: "How much space should you maintain between your chest and the steering wheel for airbag safety?", options: ["At least 25 cm (10 inches)", "At least 15 cm (6 inches)", "At least 40 cm (16 inches)", "At least 5 cm (2 inches)"], correct: 0 },
        { id: 115, text: "This sign indicates:", imgDesc: "Image: Red circle with a white horizontal line in the center", options: ["Do not enter", "Stop", "Yield", "No parking"], correct: 0 },
        { id: 116, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with a car and curved skid marks", options: ["Slippery when wet", "Winding road", "Loose gravel", "Pavement ends"], correct: 0 },
        { id: 117, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with a train locomotive icon", options: ["Railway crossing ahead", "Train station ahead", "Low ground clearance crossing", "Industrial zone"], correct: 0 },
        { id: 118, text: "This sign indicates:", imgDesc: "Image: Yellow diamond with a jumping deer icon", options: ["Animal crossing", "Zoo ahead", "Game preserve", "Scenic lookout"], correct: 0 },
        { id: 119, text: "This sign indicates:", imgDesc: "Image: Orange diamond with a surveyor icon", options: ["Survey crew ahead", "Construction zone", "Flag person ahead", "Detour ahead"], correct: 0 },
        { id: 120, text: "This sign indicates:", imgDesc: "Image: Orange diamond with horizontal line and two arrowheads", options: ["Be prepared to stop", "Lane ends", "Two-way traffic", "Obstruction ahead"], correct: 0 }
    ];

    // Helper: Fisher-Yates Shuffle
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    let quizData = [];
    let currentQuestion = 0;
    let score = 0;
    let userAnswers = [];
    let userName = "Driver";
    let isProcessing = false;

    // DOM Elements
    const startScreen = document.getElementById('start-screen');
    const quizContainer = document.getElementById('quiz-container');
    const resultsContainer = document.getElementById('results-container');
    
    const questionArea = document.getElementById('question-area');
    const feedbackArea = document.getElementById('feedback-area');
    
    const nextBtn = document.getElementById('next-btn');
    const progressFill = document.getElementById('progress');
    const counterText = document.getElementById('counter');
    
    const finalScoreEl = document.getElementById('final-score');
    const percentageEl = document.getElementById('percentage');
    const reviewList = document.getElementById('review-list');
    const passFailMsg = document.getElementById('pass-fail-msg');
    
    const usernameInput = document.getElementById('username-input');
    const displayNameEl = document.getElementById('display-name');
    const resultHeaderEl = document.getElementById('result-header');

    function startGame() {
        const inputName = usernameInput.value.trim();
        if(inputName) {
            userName = inputName;
        } else {
            userName = "Driver";
        }
        
        displayNameEl.textContent = `Player: ${userName}`;

        // Initialize Quiz Data
        quizData = originalQuestions.map(q => {
            const correctText = q.options[q.correct];
            const shuffledOptions = shuffleArray([...q.options]);
            const newCorrectIndex = shuffledOptions.indexOf(correctText);
            return {
                ...q,
                options: shuffledOptions,
                correct: newCorrectIndex
            };
        });
        shuffleArray(quizData);

        // Reset tracking
        currentQuestion = 0;
        score = 0;
        userAnswers = [];
        isProcessing = false;

        // Switch Screens
        startScreen.style.display = 'none';
        resultsContainer.style.display = 'none';
        quizContainer.style.display = 'block';

        loadQuestion();
    }

    function loadQuestion() {
        const q = quizData[currentQuestion];
        isProcessing = false;
        
        // Reset Feedback Area
        feedbackArea.innerHTML = '';
        feedbackArea.className = 'feedback-msg';

        // Image Logic
        let imgHtml = '';
        if(q.imgDesc) {
            imgHtml = `<img src="${q.id}.png" class="question-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">`;
            imgHtml += `<div class="img-placeholder" style="display:none">${q.imgDesc}</div>`;
        }

        // Options Logic
        let optionsHtml = '';
        q.options.forEach((opt, index) => {
            // Check if this option was already selected (if returning to q, though normally we don't go back)
            const isSelected = userAnswers[currentQuestion] === index ? 'selected' : '';
            optionsHtml += `<button class="option-btn ${isSelected}" onclick="selectOption(${index}, this)">${opt}</button>`;
        });

        questionArea.innerHTML = `
            <div class="question-text">${q.id}. ${q.text}</div>
            ${imgHtml}
            <div class="options-grid">
                ${optionsHtml}
            </div>
        `;

        updateProgress();
        
        if (currentQuestion === quizData.length - 1) {
            nextBtn.innerText = "Finish";
        } else {
            nextBtn.innerText = "Next";
        }
    }

    function selectOption(index, btnElement) {
        if(isProcessing) return;

        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.classList.remove('selected'));
        btnElement.classList.add('selected');
        userAnswers[currentQuestion] = index;
    }

    function checkAnswer() {
        if(isProcessing) return;

        // Validation
        const selectedIndex = userAnswers[currentQuestion];
        if (selectedIndex === undefined) {
            alert("Please select an answer.");
            return;
        }

        isProcessing = true;
        const q = quizData[currentQuestion];
        const allBtns = document.querySelectorAll('.option-btn');
        const selectedBtn = allBtns[selectedIndex];

        if (selectedIndex === q.correct) {
            feedbackArea.textContent = "Correct!";
            feedbackArea.classList.add('feedback-correct');
        } else {
            feedbackArea.textContent = "Wrong!";
            feedbackArea.classList.add('feedback-wrong');
        }

        // Wait 1 second then move on
        setTimeout(() => {
            if (currentQuestion < quizData.length - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                finishQuiz();
            }
        }, 1000);
    }

    function updateProgress() {
        const percent = ((currentQuestion) / quizData.length) * 100;
        progressFill.style.width = `${percent}%`;
        counterText.innerText = `Question ${currentQuestion + 1} of ${quizData.length}`;
    }

    function finishQuiz() {
        score = 0;
        let incorrectHtml = '';
        let attemptedCount = 0;

        // Iterate through all questions to check only what was answered
        quizData.forEach((q, index) => {
            if (userAnswers[index] !== undefined) {
                attemptedCount++;
                if (userAnswers[index] === q.correct) {
                    score++;
                } else {
                    const userOpt = q.options[userAnswers[index]];
                    const correctOpt = q.options[q.correct];

                    // Check for image
                    let reviewImgHtml = '';
                    if(q.imgDesc) {
                         reviewImgHtml = `<img src="${q.id}.png" class="review-img" onerror="this.style.display='none'">`;
                    }

                    incorrectHtml += `
                        <div class="review-item">
                            <div class="review-q">${q.id}. ${q.text}</div>
                            ${reviewImgHtml}
                            <div class="user-ans">Your Answer: ${userOpt}</div>
                            <div class="correct-ans">Correct Answer: ${correctOpt}</div>
                        </div>
                    `;
                }
            }
        });

        quizContainer.style.display = 'none';
        resultsContainer.style.display = 'block';
        
        resultHeaderEl.textContent = `Results for ${userName}`;

        const totalConsidered = attemptedCount > 0 ? attemptedCount : 1; 
        const percentage = Math.round((score / totalConsidered) * 100);
        
        finalScoreEl.innerText = `${score} / ${attemptedCount}`;
        percentageEl.innerText = `${percentage}%`;
        
        let msg = "";
        if (attemptedCount === 0) {
            msg = "You didn't answer any questions!";
        } else if(percentage >= 85) { 
            msg = "<span style='color:green; font-weight:bold'>PASSED!</span> Excellent work.";
        } else {
            msg = "<span style='color:red; font-weight:bold'>FAILED</span> Keep studying!";
        }
        passFailMsg.innerHTML = msg;

        if (incorrectHtml === '') {
            if (attemptedCount > 0) {
                reviewList.innerHTML = '<p style="text-align:center; color:green;">Perfect Score on attempted questions!</p>';
            } else {
                reviewList.innerHTML = '';
            }
        } else {
            reviewList.innerHTML = incorrectHtml;
        }
    }

    document.querySelector('#results-container .btn-next').onclick = startGame;
</script>

</body>
</html>